<% include ./partials/header %>




 <!--========================================================================================-->




 
 
 <!--=====================================================================================-->
 <!--BOOTSTRAP COLUMNS-->
 <!--=====================================================================================-->
 <div id="content">
 <div class="container">
     <div class="row">
   
   
     <div class="col-lg-2 col-sm-10 col-md-10">
     <div id = "kotdiv">
         
                 <p class="head">-<%= bill.billType %><span id="kotspan"></span>-</p><hr>

            <p class="text-center"><b>Table Number : </b><%= bill.tablenumber %></p>
            <p class="text-center"><b>Waiter Name: </b><%= bill.waitername %><span id="kwn"></span></p>
            <p class="text-center"><b>Order No. : </b><%= bill.bn %></p>
         

         <hr>
               <table id="kottable" class="table table-sm table-bordered ">
  <thead>
    <tr>
      
      <th scope="col">Particulars</th>
      <th scope="col">Qty.</th>
      
    </tr>
  </thead>
  <tbody>
     <% bill.meals.forEach(function(meal){ %> 
    <tr>
      
      <td><%= meal.mealname %></td>
      <th scope="row"></th>
      
      
    </tr>
    <% }); %>  
  </tbody>
</table>
    </div><br>
    <div class="form-group">
    <button style="margin-left:auto;margin-right:auto;display:block;margin-top:0%;margin-bottom:0%"  id="printkot" type="button" class="btn btn-success">Print KOT</button></div>
   <div class="form-group"> <button style="margin-left:auto;margin-right:auto;display:block;margin-top:0%;margin-bottom:0%"  id="delkot" type="button" class="btn btn-danger">Delete KOT</button></div>
    
    </div>
    
   
<!--========================================================================================-->
<!--SHOW MEALS-->
<!--========================================================================================-->
 <div class="col-lg-6 col-sm-10 col-md-10">

             
<ul class="list-group">
  <li class="list-group-item active">Order Number : <b id="orderNumber" ><%= bill.bn %> </b></li>
  <li class="list-group-item">Table Number : <b id="tableNumber" ><%= bill.tablenumber %></b></li>
  <li class="list-group-item">Waiter Name : <b id="waiterName" ><%= bill.waitername %><span class="wn"></span></b></li>
</ul>
           
     
     <hr>
     
     
     
                <!--==============================START===================-->

<ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
     
      <% cats.forEach(function(cat){ %>

  <li class="nav-item">
    <a class="nav-link" id="pills-<%=cat.name%>-tab" data-toggle="pill" href="#pills-<%=cat.name%>" role="tab" aria-controls="pills-<%=cat.name%>" aria-selected="true"><%=cat.name%></a>
  </li>
    <% }) %>
    
  

</ul>



<div class="tab-content" id="pills-tabContent">
          <% cats.forEach(function(cat){ %>

  <div class="tab-pane fade show" id="pills-<%=cat.name%>" role="tabpanel" aria-labelledby="pills-<%=cat.name%>-tab"><h1><%=cat.name%></h1>
  
  <div class="text-center" style = "display:flex; flex-wrap:wrap;">

        
        
        <% meals.forEach(function(meal){ %>
        
           <% if(meal.mealcategory ==  cat.name ){ %>

        
        
            <div  data-id-value = "<%= meal  %>"  data-mealname-value = "<%= meal.mealname  %>"  data-mealprice-value = "<%= meal.mealprice  %>" class="card meal-card" style="width: 7rem;">
                    
                        <!--<h4 class="add" data-price="<%= meal._id  %>"><%= meal._id %></h4>-->
                      <!--<img class="card-img-top" src="<%=meal.image%>" alt="Card image cap" >-->
                    <div class="card-block">
                        
                        <h6 class="card-title"   data-name="<%= meal.mealname  %>"> <%= meal.mealname %> </h6>
                        
                        <!--<p><%=  meal.comment %></p>-->
                        
                
                        <h6 data-pric="<%= meal.mealprice  %>"  class="btn btn-primary">Rs. <%= meal.mealprice  %></h6>
                        
                      
                    </div>
            </div>
            <% } %>
        <% }); %>
        
        
        
    </div>
  
  
  </div>
           
           <% }) %> 
  </div>
          <!--==============================END===================-->
        <hr>
        
      <!--==============================END===================-->
    
    
    </div>
    
    
 <!--========================================================================================-->
 <!--SHOW ITEMS IN BILL-->
 <!--========================================================================================-->
         <div class="col-lg-4 col-sm-10 col-md-10" >
             <div id="space">
             
              <p class="ilm"><b>Bill Type </b> 
        <span class="right">
                <select  style="display:inline  " class="form-control" id="billType" >
                  <option id="dineIn">Dine In</option>
                  <option id="takeAway" >Take Away</option>
                  <option id="delivery">Delivery</option>
                  
                </select></span></p></div><hr>
             
             <form>
  <div class="row">
    <div class="col">
      <p style="display:inline" >Cutomer Phone:</p>
    </div>
    <div class="col">
      <input type="text"  value="<%= bill.cPhone %>" id="cPhone" name="cPhone" class="form-control" placeholder="Number">
    </div>
    <div class="col">
     <button type="button" class="btn btn-success" id = "findCust">Go</button>
    </div>
  </div>
</form>
           <script>
$('#findCust').click(function () {
    var cPhone = $('#cPhone').val();
    
    
 
    
    $.ajax({
        url: '/api/getcust',
        type: "POST",
        data: {cPhone},
        dataType: 'json',
        success: function (data) {
           var name = data.cName
           var email = data.cEmail
           var phone = data.cPhone
           
           $('#cPhone').val(phone)
           $('#cEmail').val(email)
           $('#cName').val(name)
           
            $('#cn').html(name)
            $('#cp').html(phone)
            $('#ce').html(email)
           
           $('#cPhone').css('border','2px solid lightgreen')
           $('#cEmail').css('border','2px solid lightgreen')
           $('#cName').css('border','2px solid lightgreen')
            
        }
    });
});
</script>  
             
    <form class="form-inline" id = "theform">
        
        
        
       

        <div class="form-group">
             <p style="display:inline-block"  for="custName">Customer Name</p>
        <input class="form-control" style="margin-left:2.1em;" type = "text" name="cName" id = "cName" placeholder = "Customer Name" value="<%= bill.cName %>"></div>
        
        
   
        
        <div class="form-group">
             <p style="display:inline-block"  for="custEmail">Customer E-Mail</p>
        <input class="form-control"  style="margin-left:2em;" type = "text" name="cEmail" id = "cEmail" placeholder = "Customer E-Mail"  value="<%= bill.cEmail %>"></div>
    
    
           <div class="form-group">
             <p style="display:inline-block "  for="wName"> Waiter's -- Name </p>
        <input class="form-control"  style="margin-left:2em;" type = "text" name="wName" id = "wName" placeholder = "Waiter Name"  value="<%= bill.waitername %>"></div>
    
    
    </form>  
    
    <div id ="billdiv" >

        
        <p class="head">---<%= bill.billType %><span id="bt"></span>---</p><hr>
        <p class = "head" ><b><%= currentUser.restoname %></b></p>
         <p class = "text-center billp" ><%= currentUser.add1  %></p>
        <p  id = "tId"><%= bill.tableId %></p>
         <p class = "text-center billp" ><%= currentUser.add2  %></p>
         <p class = "text-center billp" ><%= currentUser.add3  %></p>
          <p class = "text-center billp" >PH. <%= currentUser.phone  %></p>
          <p class = "text-center billp" >GST No. <%= currentUser.gst  %></p>
          <p class = "text-center billp" >CIN No. <%= currentUser.cin  %></p>
        
          <hr id="billtablemargin">
          
    <li class="il"><b>Waiter Name: </b><%= bill.waitername %><span class="wn"></span><span class="right"> <b>Order No.:</b> <%= bill.bn %></span></li>
    <li class="il dates" style="margin-top:0.8em; margin-bottom:0.8em; line-height:2px;" ><b>Date: </b> <%= bill.created %></li>



    <li class="il dates"><b>Bill ID: </b><%= bill._id %></li>

        <hr><li class="il"><b> Customer Details: </b><span class="right"> <p style="display:inline" ></p></span></li>

        <li class="il"><b>Name: </b><%= bill.cName %><span id="cn"></span><span class="right"> <b>Phone: </b><%= bill.cPhone %><span id="cp"></span></span></li>

    
    
    <li class="il"><b>E-Mail: </b><%= bill.cEmail %><span id="ce"></span></li><hr>
   
    <!--<li class="il" id="asd"><span class="right">Date: <%= bill.created %> </span></li>-->

         
          <!--<p class = "text-left billp" style=" display: inline;">Waiter Name : <%= bill.waitername %>    </p>-->
          <!--<p class = "text-right billp" style="text-indent: 50px; display: inline;" >   Order No. : <%= bill.ordernumber %>    </p>-->
        
         <table id="billtable" class="table table-sm table-bordered ">
  <thead>
    <tr>
      
      <th scope="col">Particulars</th>
      <th scope="col">Qty.</th>
      
      <th scope="col">Rate</th>
      <th scope="col">Amount</th>
    </tr>
  </thead>
  <tbody>
     <% bill.meals.forEach(function(list){ %>

      
    <tr id="<%=list.id%>">
      
      <td name="foodqty"><%= list.name %></td>
      <td name="qty"><%= list.qty %></td>
      
      <td class="money"><%= list.price %></td>
      <td name = "rate"><%= list.rate %></td>
    </tr>
    
    
    <% }); %>  
    
  </tbody>
</table>
    <li class="il"> <b>Total Amount : </b><span class="right"> Rs. <p style="display:inline" id="totalAmt"><%=bill.totalAmt%><spanid="toa"></span></p></span></li>
    <li class="il"> Discount (-): <span class="right">  <p style="display:inline" ><%=bill.discount%><span id="dis"></span> %</p></span></li>
<br>

    <li class="il"><b> Tax Breakup </b><span class="right"> <p style="display:inline" ></p></span></li>
    <li class="il"> C GST @ 2.5% : <span class="right"> Rs. <p style="display:inline" id="cgst"><%=bill.cgst%></p></span></li>
    <li class="il"> S GST @ 2.5% : <span class="right"> Rs. <p style="display:inline" id="sgst"><%=bill.sgst%></p></span></li>
    <li class="il"> Total Tax (+): <span class="right"> Rs. <p style="display:inline" id="tax"><%=bill.tax%></p></span></li>

               <br> <li class="ilb"><b>Gross Amount: </b> <span class="right"><b>Rs.</b> <p style="display:inline" id="total_gross"><%=bill.total%></p></span></li>
    <br><li class="il"> Payment Method : <span class="right"> <p style="display:inline" id="tax"><%=bill.pm%><span id="pm"></span></p></span></li>


        <!--<p style="display:inline ">Total:</p><span>   </span><p style="display:inline" id="total_forces"></p>            -->
        
    
       <!--<hr ><p class="text-center">SCAN THIS QR CODE ⇊ LIKE US ON FACEBOOK</p><img id="fb" src="https://lh3.googleusercontent.com/wGpOYLQ-QVqsgV5cznD_QwUQt9nfe7_qFKZDDVaQoBPzKTLxyNt0d0hH0sCUkyCnQK7pNgZik52wlnl4bFLu4boiFJ015JrnOBmh9Ds2UzTE9TZ3l9E9ATfxiSe-uZ2QJR83PnzukSuppe58SWAFAFEcu7qEyzrIZbxiKeCgR8oNqAgnAOICAyE7EXw6SRRCyHoRs2trR0B9lwg09IkYtfSSKlEkiAuFVyeM938_dXgJ8lb1X9QA1zzecyi5VrxxaCI_rtQZFfwMnXZuCNKsfkh-JgEQbVaxTrFgyBSqbZq87MN7wODA8_6ifpKNlhblrN4PltG_wHDORLbCRWTO-hUPlfmMoiY0ct_MTLveGHdaBU2gaqzKP9viBbwQaBfI22WlBwhxPst4ZOAd9uEjMmufk4NHyxTiD4DVEk8wR2xAtbQA8xy4Bfl7ckTJdIrv6tOu65hCZHNT79cmfcFXjEfprU3a0Jv6z0FWRwR3XOtrdDdTOuqC7Rr6yEAVNAnPWnOiyrC4usQXVDhr51uvrKJomLzbCOp5ewNA995zKyl0-lztJY23WiLQo_RJlvnTNe0nnYPteB_oacc_b4nWRMdPo8aYzO8Hp9RD6Hn0FWao2XlITR1qPLVY95iNo9DlnVO3qBYSf7KU0y1kOCiGamxnjaDVypz8jg=s328-no" class="img-thumbnail">-->
      <!--https://photos.google.com/share/AF1QipOfX0Q45p09vNr4zcpciNxzthegIYQMigvf8Kmi3mJ3GlK_qHuQ7JlGi1ROU5kh0A/photo/AF1QipO-7vEN9q_2AnEciij8Z5Uy_XJUjq9iQh68_7sC?key=WUJmLUJSXzZhbWhaU2MzUUtXQklKbElMdTJlUXV3-->
 <!--<p class = "text-center" >Come again another day</p><hr>--><hr>
 <p class = "text-center" style="font-size:10px;" >Give your valuable feedback and get an offer on your next bill @ <a style="color:black" href = "https://Ornio.herokuapp.com/feedback/<%= bill.id%>">https://Ornio.herokuapp.com/feedback/<%= bill.id%></a> </p><hr>
 <p class = "text-center" style="font-size:10px;" >Billing system developed by Ornio Lab - AryaSumit145@gmail.com</p><hr>

  
  </div>
<br>




 <div class="form-group">
     

      <form>
  <div class="row">
    <div class="col">
      <p style="display:inline" ><b>Discount: </b></p>
    </div>
    <div class="col">
      <input type="text" id="discountPercentage" class="form-control" placeholder="In %">
    </div>
    <div class="col">
     <button type="button" class="btn btn-success" id = "applyDiscount">Apply Discount</button>
    </div>
  </div>
</form>
      
      
      <!--<p class="ilm"><b>Discount </b> -->
      <!--  <span class="right">-->
      <!--          <input  style="display:inline" class="form-control" id="discount" value="<%= bill.discount %>">-->
                  <!--<option id="5">5 %</option>-->
                  <!--<option id="10" >10 %</option>-->
                  <!--<option id="el">15 %</option>-->
                  
      <!--          </input></span>-->
      <!--          <button style="display:inline" >Calculate</button>-->
                
      <!--          </p><br>-->
         
     <p class="ilm"><b>Payment Method </b> 
        <span class="right">
                <select  style="display:inline" class="form-control" id="payment">
                  <option id="cash">Cash</option>
                  <option id="cash" >Card</option>
                  <option id="electronic">Electronic</option>
                  
                </select></span></p><br>
                
               
                
                
  <button style="margin-left:auto;margin-right:auto;display:block;margin-top:0%;margin-bottom:0%"  id="sendBill" type="button" class="btn btn-lg btn-success btn-block">Upload Bill</button><br>
  <button style="margin-left:auto;margin-right:auto;display:block;margin-top:0%;margin-bottom:0%"  id="newBill" type="button" class="btn btn-lg btn-primary btn-block">New Bill</button><br>
  <a  href="/api/dashboard" ><button style="margin-left:auto;margin-right:auto;display:block;margin-top:0%;margin-bottom:0%"  class="btn btn-lg btn-primary btn-block">Dashboard</button></a><br>
   <!--<div class="form-group">-->
  <!--<button onClick="download()">Download</button>-->
  <!--<button style="margin-left:auto;margin-right:auto;display:block;margin-top:0%;margin-bottom:0%" onClick="download()" type="button" class="btn btn-lg btn-info btn-block">Download PDF</button></div>-->

    <!--<div class="form-group">-->
    <!--        <button id="printbill" class="btn btn-lg btn-primary btn-block" >Print Bill</button>-->
    <!--        </div>-->
   
   
   
 
     <script>
     
      $("#tId").hide();


  
          $('#newBill').click(function(){
            window.location.href= "/newbill"  
              
          })
          
          
     $('#sendBill').click(function(){
    $(this).prop('disabled', true);
          var meals = JSON.stringify(myList);
          var total = $('#total_gross').text()
          var cgst = $('#cgst').text()
          var sgst = $('#sgst').text()
          var tax = $('#tax').text()
          var pm = $('#payment').find(":selected").text();
          var cName = $('#cName').val()
          var cPhone = $('#cPhone').val()
          var cEmail = $('#cEmail').val()
          var billType = $('#billType').find(":selected").text();
          var discount = $('#discountPercentage').val();
          var totalAmt = $('#totalAmt').text()
          var wName = $('#wName').val()
          console.log("wName "+ wName)

        $('#cn').html(cName)
        $('#cp').html(cPhone)
        $('#ce').html(cEmail)
        $('#bt').html(billType)
        $('#dis').html(discount)
        $('#toa').html(totalAmt)
        $('#pm').html(pm)
        $('.wn').html(wName)
        console.log(wName)
        
        
        var id = $('#tId').text()
        
        // xxx
        $.ajax({
        url: '/api/falsetable?_method=PUT',
        type: "POST",
        data: {id},
        dataType: 'json',
        success: function (data) {
           var name = data.name
           var available = data.available
           var username = data.username
           
           console.log(name)
           console.log(available)
           console.log(username)
           
                      $(this).toggleClass("black")

        }
    });
        // xxx
        
        
        
        
        
        
        var divContents = $("#billdiv").html();//div which have to print
                var printWindow = window.open('', '', 'height=700,width=900');
                printWindow.document.write('<html><head><title>BILL</title>');
                printWindow.document.write('<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" >');//external styles
                printWindow.document.write('<link href="https://fonts.googleapis.com/css?family=Share+Tech+Mono" rel="stylesheet">');//external styles
                printWindow.document.write('<style>font-family: "Share Tech Mono", monospace;</style>');//external styles
                printWindow.document.write('<link rel="stylesheet" href="/stylesheets/main.css" type="text/css"/>');
                printWindow.document.write('</head><body>');
                
                printWindow.document.write(divContents);
                printWindow.document.write('</body></html>');
                printWindow.document.close();

                printWindow.onload=function(){
                printWindow.focus();                                         
                printWindow.print();
                printWindow.close();
                }




var waitername=wName


     var details = {billType, total, cgst, sgst, tax, pm, cName, cPhone, cEmail, discount, totalAmt, waitername}
          console.log(details)
          
   
              $.post( "/bills/<%= bill._id %>", {meals} )
                      .then(
                                  
                              
                              $.post("/bills/<%= bill._id %>/bd", {waitername, billType, total, cgst, sgst, tax, pm, cName, cPhone, cEmail, discount, totalAmt:totalAmt})
                                   )
       
      

})

   
     
     </script>
     
      
             
 </form>
  
  </div>
 </div>
 



<!--========================================================================================-->
    
    
<div class='container fluid'>
    <hr>
    <h1>Feedback</h1> 
        
            <hr>
                        <% bill.feedback.forEach(function(feedback){ %>

            <ul class="list-group">
              <li class="list-group-item"><b>Feedback Number: </b><%= feedback.fn %></li>
              <li class="list-group-item"><b>Order Number: </b><%= feedback.orderNumber %></li>
              <li class="list-group-item"><b>Customer Name: </b><%= feedback.custName %></li>
              <li class="list-group-item"><b>Customer Phone Number: </b><%= feedback.custPhone %></li>
              <li class="list-group-item"><b>Comment: </b><%= feedback.comment %></li>
              <li class="list-group-item"><b>Date: </b><%= feedback.created %></li>
            </ul><br>
                       <% }) %> 
            
    </div>
    
    <!--============================SCRIPTING START===============================-->
<style>
    @media (max-width:480px)  {
    /* smartphones, iPhone, portrait 480x320 phones */ 
    #content{
        margin-top: 4em;
    }
    
    .meal-card{
        margin-left: 4em;
    }
    

    
}
</style>
    

    <script>
    
// var array = [];
//     var headers = [];
//     var myList=[]
    
//     headers.push("name")
//     headers.push("qty")
//     headers.push("price")
//     headers.push("rate")
//     headers.push("id")
    
//     $('#billtable tr').has('td').each(function() {
//         var arrayItem = {};
//         $('td', $(this)).each(function(index, item) {
//             arrayItem[headers[index]] = $(item).html();
//             arrayItem[headers[4]]= $(this).closest("tr").attr("id")
//         });
        
      
        
        
//         array.push(arrayItem);
//         myList.push(arrayItem)
        
//     });
// console.log(myList)
// // alert(JSON.stringify(array));

// 

    var array = [];
    var headers = [];
    var myList=[]
    var mealList=[]
    var mealqty={}
    
  
    

    headers.push("name")
    headers.push("qty")
    headers.push("price")
    headers.push("rate")
    headers.push("id")
    
    $('#billtable tr').has('td').each(function() {
        var arrayItem = {};
        $('td', $(this)).each(function(index, item) {
            arrayItem[headers[index]] = $(item).html();
            arrayItem[headers[4]]= $(this).closest("tr").attr("id")
            arrayItem[headers[2]]=Number(arrayItem[headers[2]]) //price
            arrayItem[headers[3]]=Number(arrayItem[headers[3]]) //rate
            arrayItem[headers[1]]=Number(arrayItem[headers[1]]) // qty
        });
        
        var mealname=arrayItem[headers[0]]
        
        mealqty[mealname] =arrayItem[headers[1]]
        console.log("haha " + mealqty[mealname])
        
        
      mealList.push(arrayItem[headers[0]]) //name
        
        
        array.push(arrayItem);
        myList.push(arrayItem)
        
        
        
    });
console.log(myList)
console.log(mealList)


// =======================


var mealqty2={}



var kotMealList = []



//  =======================================

$(".card").unbind().on("click", function(){
    console.log("IN card click")
 var mealid=$(this).data("id-value");

 
 var mealid = mealid.split( "\n" );
 var mealid = mealid[0]
 var mealid = mealid.replace( "{ _id: ", "" )
 var mealid = mealid.replace( ",", "" )

 
 var mealname=$(this).data("mealname-value");
 var mealprice=$(this).data("mealprice-value"); 


 if (mealList.includes(mealname)){
     
      
 console.log("IN $card, IF")
     
          mealqty[mealname] = mealqty[mealname]+1;
          
          $('#'+mealid).html('<td>' + mealname + '</td><th scope="row"><span>'+ mealqty[mealname] +'</span> <span class = "del"><i class="fa fa-minus-circle" aria-hidden="true"></i></span></th><td>' + mealprice + '</td><td>' + mealprice*mealqty[mealname] + '</td>')
          
           var Qty=mealqty[mealname];
          
        
          
          var myObject = new Object();
                myObject.name = mealname;
                myObject.qty = mealqty[mealname];
                myObject.id = mealid;
                myObject.price = mealprice;
                myObject.rate = mealprice*mealqty[mealname];
                
            
                myList = $.grep(myList, function(e){ 
                 
                  return e.name != myObject.name; 
                  
                    });
                
    
              myList.push(myObject)
                  
     //change total grosss amount accordingly in bill table
    
     
  

  }
 else {
     console.log("IN $card, ELSE ")
          mealList.push(mealname);
          
          mealqty[mealname] = 1;
          
          
          
          var newTab=$('<tr class="tableMealId"  id ='+ mealid + '><td>' + mealname + '</td ><th scope="row"><span>' + mealqty[mealname] + '</span> <span class = "del"><i class="fa fa-minus-circle" aria-hidden="true"></i></span></th><td>' + mealprice + '</td><td>' + mealprice*mealqty[mealname] + '</td></tr>')
          newTab.data('id',mealid)
           $('#billtable').append(newTab)
          
          
      
          var Qty=mealqty[mealname];
          
            
            
              var myObject = new Object();
                myObject.name =  mealname;
                myObject.qty = mealqty[mealname];
                myObject.id = mealid;
                myObject.price = mealprice;
                myObject.rate = mealprice*mealqty[mealname];


              myList.push(myObject)



        var total = Number($('#total_gross').text())
        
        var cgst = $('#cgst').text()
        var sgst = $('#sgst').text()
        var tax = $('#tax').text()
       
        var t = total + mealprice 
        var pertax= 0.05*mealprice
        t=t+pertax
        console.log("this is t " + t)
        
          var totalAmt = $('#totalAmt').text()
        totalAmt = totalAmt + mealprice
        $('#totalAmt').text(totalAmt)
        
        
        
        $('#total_gross').text(t.toFixed(2)) 
      
                  


 }
 
//  =======================================
 
 
 $('span.del').unbind().click(function(event){
     console.log(event.currentTarget)
          console.log(event.target)

     console.log("Event fired")
                    var mealid = $(this).closest("tr").attr("id")
                        console.log(mealid)
     
                     var span=$(this).parent().find("span").first();
                        console.log("quantity " + span.text())
                        var qtyspan = span.text();
                     
                     var mealname=$(this).closest("tr").find("td").first().text();
                        console.log("ame " + mealname)
                     
                      var mealprice=$(this).closest("tr").find("td").first().next().next().text();
                        console.log("price " +mealprice)
    
                    var mealrate = $(this).closest("tr").find("td").first().next().next().next().text();
 var pertax = 0.05*mealprice
        console.log("pertax " + pertax)
    
  if(qtyspan==1){
      console.log("IF Quantity = 1")
      // Delete Row
       $("#billtable tr#"+mealid).remove();

            mealList = $.grep(mealList, function(e){ 
                  return e != mealname; 
                    });
              
      
      // Delete object from myList 
           myList = $.grep(myList, function(e){ 
                  return e.name != mealname; 
                    });
                    
                    
         // Delete object from kotList 
           kotMealList = $.grep(kotMealList, function(e){ 
                  return e != mealname; 
                    });            
                    
        kotMealList            
              
        //change total grosss amount accordingly in bill table
    
        var total = $('#total_gross').text()
        
        var cgst = $('#cgst').text()
        var sgst = $('#sgst').text()
        var tax = $('#tax').text()
       
        var t = total - mealprice 
        t=t-pertax
        console.log("this is t " + t)
        
          var totalAmt = $('#totalAmt').text()
        totalAmt = totalAmt - mealprice
        $('#totalAmt').text(totalAmt)
        
        
        
        $('#total_gross').text(t.toFixed(2)) 
      
        var c = cgst - (0.025*mealprice)  
        if(isNaN(c)|| c<0)   {
                                     c=0
                                    }
                                    
        $('#cgst').text(c.toFixed(2))
        
        var s = sgst - (0.025*mealprice)     
         if(isNaN(s)|| s<0)   {
                                     s=0
                                    }
                                    
        $('#sgst').text(s.toFixed(2))
        
        var ta = c + s;
        
                    if(isNaN(ta)|| ta<0 || ta<1)   {
                                     ta=0
                                    }
                                    
        $('#tax').text(ta.toFixed(2))
        
        
        console.log("TA_ " + ta)
                    
      
  } else {
      
      console.log("ELSE Quantity > 1")
      // Decrement qty span
      qtyspan = Number(qtyspan) - 1;
      
    span.text(qtyspan)
    // change qty obj
    
      
      // decreasing myObject.qty from myList
        
                myList = $.grep(myList, function(e){ 
                    if(e.id==mealid){
                        e.qty=Number(e.qty)-1;
                    }
                  return e; 
                    });
              
        //change rate accordingly in myList
        
                myList = $.grep(myList, function(e){ 
                    if(e.id==mealid){
                        e.rate=Number(e.rate)-Number(mealprice);
                    }
                  return e; 
                    });
        
        //change total grosss amount accordingly in bill table
    
        var total = $('#total_gross').text()
        
        var totalAmt = $('#totalAmt').text()
        totalAmt = totalAmt - mealprice
        $('#totalAmt').text(totalAmt)
        
        var t = total - mealprice
        t=t-pertax
        console.log("this is t " + t)
        $('#total_gross').text(t.toFixed(2)) 
        
        
        
      //change html
      
            var nee = mealrate - mealprice
                $(this).closest("tr").find("td").first().next().next().next().text(nee);
                
                   //change total grosss amount accordingly in bill table
                
                    var total = Number($('#total_gross').text())
                    var cgst = Number($('#cgst').text())
                    var sgst = Number($('#sgst').text())
                    var tax = Number($('#tax').text())
                    
                    
                  
                    var c = cgst - (0.025*mealprice)      
                    $('#cgst').text(c.toFixed(2))
                    
                    var s = sgst - (0.025*mealprice)      
                    $('#sgst').text(s.toFixed(2))
                    
                    var ta =  (c + s);
                    console.log("TA_ " + ta)
                    if(isNaN(ta)){
                        ta=0
                    }
                    
                     $('#tax').text(ta.toFixed(2))
                     console.log("C" + c)
                     console.log("S" + s)
                     console.log("T" + ta)

  }
  
   
 
if (kotMealList.includes(mealname)){
    
          mealqty2[mealname] = mealqty2[mealname]-1;
          
          $('#'+mealid+'_a').html('<td>' + mealname + '</td><th scope="row">'+ mealqty2[mealname] +'</th>')
          
 } else {
  
        //   $('table#billtable tr#'+mealid+'_a').remove();
        //   $("#billtable tr#"+mealid).remove();
          $('#'+mealid+'_a').remove()
console.log("HERE")
 }



}) //== minus icon click end

 //  =======================================
 
 
 
 
 
 
 
 
 
 
if (kotMealList.includes(mealname)){
    
          mealqty2[mealname] = mealqty2[mealname]+1;
          
          $('#'+mealid+'_a').html('<td>' + mealname + '</td><th scope="row">'+ mealqty2[mealname] +'</th>')
          
 } else {
  
          kotMealList.push(mealname);
          mealqty2[mealname] = 1;
          
          $('#kottable').append('<tr id ='+ mealid+ '_a><td>' + mealname + '</td><th scope="row">'+ mealqty2[mealname] +'</th></tr>');
         
 }




  var pregst = mealprice - 0.05*mealprice;
     
 
 
 


//  alert(kot)
 
//  $('#myTable').append('<tr><td>my data</td><td>more data</td></tr>');

var result = [];
  $('table tr').each(function(){
  	$('td', this).each(function(index, val){
    	if(!result[index]) result[index] = 0;
      result[index] += parseInt($(val).text());
    });
  });
  
  $('table').append('<tr></tr>');
  
  
  $(result).each(function(){
      

        var cgst=this*0.025;
         	$('#cgst').html(cgst.toFixed(2))
    
        var sgst=this*0.025;
         	$('#sgst').html(sgst.toFixed(2))
        var tax = cgst + sgst;
      
        var pregsttotal = (this ).toFixed(2);

    var x = tax;
    var y = this;
    var z = x+y
    $('#totalAmt').html(pregsttotal)
   	$('#total_gross').html(z.toFixed(2))
    $('#tax').html(tax.toFixed(2))

  });
 
 
});


</script>
    


<script type="text/javascript" src="../js/main.js"></script>
<script type="text/javascript" src="../js/alert.js"></script>


<% include ./partials/footer %>
